import pandas as pd
import json
import folium
from datetime import datetime

# Specify the path to the CSV file
csv_file_path = 'src/Mapping/map_data.csv'  # Replace with the actual path to your CSV file

# Read the CSV file into a DataFrame
df = pd.read_csv(csv_file_path)

# File paths
json_file_path = 'src/Mapping/map_data.json'  # Desired JSON file name

# Convert DataFrame to JSON
markers = df.apply(lambda row: {
    "location": [row['latitude'], row['longitude']],
    "tooltip": row['tooltip'],
    "popup": row['popup'],
    "icon_color": 'red' if datetime.strptime(row['date'], '%Y-%m-%d') < datetime(2024, 1, 1) else 'green'  # Assuming the 'date' column exists
}, axis=1).tolist()

# Write data to a JSON file
with open(json_file_path, 'w', encoding='utf-8') as jsonfile:
    json.dump(markers, jsonfile, indent=4)

print("CSV data has been written to JSON file.")

# Reading the JSON file
with open(json_file_path, 'r', encoding='utf-8') as file:
    markers_data = json.load(file)

# Displaying the data to verify
print(json.dumps(markers_data, indent=4))

# Initialize a Folium map
map = folium.Map(location=[43.70876, -79.6954], zoom_start=10)

# Create feature groups for different marker colors
red_group = folium.FeatureGroup(name='Before 2024')
green_group = folium.FeatureGroup(name='2024 and Later')

# Add markers to the appropriate feature group
for marker_data in markers_data:
    marker = folium.Marker(
        location=marker_data['location'],
        tooltip=marker_data['tooltip'],
        popup=marker_data['popup'],
        icon=folium.Icon(color=marker_data['icon_color'])
    )
    if marker_data['icon_color'] == 'red':
        marker.add_to(red_group)
    elif marker_data['icon_color'] == 'green':
        marker.add_to(green_group)

# Add feature groups to the map
red_group.add_to(map)
green_group.add_to(map)

# Add LayerControl to switch between groups
folium.LayerControl().add_to(map)

# Save the map to an HTML file
map.save("src/Mapping/map.html")

print("Map with markers has been created.")
print(markers_data[:1])
